嗅探器是一种基于被动侦听的网络分析方式。可以监听网络状态，可以对于故障进行诊断分析，查看数据流动情况（识别一个及其是否用于挖矿）。同时还能获得网络上传输的信息（盐究 social media 即社交网络，同时需要溯源信息）以及处理网络入侵检测（检测网络是否被入侵了，是自身性能性能问题还是真的被攻击了）。

## 挑战：
在**集线器，路由器，交换机**中，我们的对应的对于流量的处理方式是不同的。也就是说，我们在我们的终端安装我们的嗅探器收到的内容是有限的。这一步也就是在选择**嗅探器的位置**。我们选择的位置要满足下面的几个点：
1. 全覆盖，要求覆盖我们所有的区域（和代价问题的平衡）
2. 数据报文可能存在冗余，少数情况下会产生丢包问题

## 网卡捕捉：
我们捕捉网络数据包一定需要使用昂卡，并且讲网卡设置为混杂模式。允许网卡能够查看所有流经网络线路数据包的驱动模式。（需要考虑操作系统，网卡的运行模式，会影响我们的收到的数据报文的内容）

常规工作模式时，我们仅仅接受数据包中的目的地址时当前主机的 IP 地址的数据包（MAC 地址一致）。其中我们的网卡 MAC 地址也可以修改的（冒充其他的设备）。但是要考虑冲突的问题。

## 集线器（几乎没有）：
集线器一般是提供了多个端口的机盒，提供一个不受限制的可视范围，这一种设备在数据包嗅探器能看到的东西，由我们的**数据包嗅探器中能够看到通信流量的主机范围决定**。这个时候，我们的 IP 地址由我们的服务提供商来提供一个子网内的数据。或者通过 DHCP 协议来提供分配。

集线器只在半双工模式下运行，当多个设备通过是通信的时候，将产生冲突碰撞。不能用于高密度的网络

## 交换机
交换器和集线器相比，我们会把收到的所有的数据包之发送到目的计算机所连接的端口。负责我们的**转发功能**。（区别我们的转发和路由，转发一般只有一条路径，没得选，而路由主要的重点在于我们的**选择**）。

交换机的本质是一个高效的**交换阵列（CAM 表）**。能够禁用或者启用某些特定端口，同时查看端口参数。（一种攻击方法可以是攻击我们的交换阵列）。

### 交换机上的嗅探
交换机上嗅探数据包的时候，只能收到广播数据包。以及由自己电脑锁发送或者接受的数据包。因此，常规部署的修叹息，不能很好的实现数据包捕获的效果。

#### 端口镜像（硬件上实现）
我们可以通过我们的端口镜像的方法来让我们的界面可以访问我们的交换器。通过命令行活 web 管理界面访问交换机，然后启用端口镜像，这样就能让我们不管通过哪一个端口传输的报文，都需要传输到我们的镜像端口中。

这种情况，镜像端口的流量要求很高

#### 集线器输出（硬件上操作）：
通过设置极限去输出，在我们的终端与电脑之间添加一个新的设备集线器，然后

#### 分流器（硬件上操作）：
分流器是一个硬件设备，将他放置在网络布线系统的两个断电之间，来捕获两断电之间的数据包。（偷电）

#### ARP 欺骗（软件上操作）:
[[5.6.2ARP协议]]，即 IP 地址转换为对应的 MAC 地址。而我们中间的映射关系，可以通过广播学习得到的。与之相对比，我们的 IP 地址映射到我们的 URL，是通过我们的 DNS 协议进行的。（两者都会被攻击，通过缓存的方法来进行加速处理）。

ARP 欺骗，一次欺骗只能够让对**一个会话**进行完全监听，这个时候就需要**双向欺骗**。

## 路由器：
路由器和交换机的异同：[[4.7.1路由器]]，[[5.7.1集线器与交换机]]

|          | Switch             | Router   |
| -------- | ------------------ | -------- |
| 功能     | 高性能交换阵列     | 选择路径 |
| 载体     | CAM 表             | 路由表项 |
| 数学模型 | 交换映射（排队论） | 图论     |

我们一般来说，都是在我们的**网关节点**部署嗅探器获取数据报文，我们的对应的可视范围就是**几乎所有的内容**（ 不包括局域网内部的内容）。那如果我们希望做到完全的 coverage，我们就需要在**每一个路由器上都安装嗅探器**。

嗅探方法优劣对比：

|     | 方法     | 优点  | 缺点                     |
| --- | ------ | --- | ---------------------- |
|     | 端口镜像   |     | 额外的数据包                 |
|     | 集线器输出  |     | 碰撞和丢包降低性能，集线器的带宽抵      |
|     | 分流器    |     | 成本高                    |
|     | ARP 欺骗 |     | 会注入数据包到网络中，相对草率（会暴露自己） |
|     | 直接安装   |     | 主机存在故障时，会导致数据包丢失       |

注意，我们的成本，指的是我们的硬件成本，即监听操作对于端口，贷款的影响，以及对于正常网络通信的影响。最后就是我们的 NIC，以及是否产生**攻击痕迹**。最后的**攻击权限**。