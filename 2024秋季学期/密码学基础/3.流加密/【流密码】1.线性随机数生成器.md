## PRNG
### 定义：
伪随机数生成器（pseudorandom number generator，PRNG），又称为确定性随机位生成器（deterministic random bit generator，DRBG），是用来生成**接近于绝对随机数序列的数字序列**的算法。一般来说，PRNG 会依赖于一个初始值，也称为种子，来生成对应的伪随机数序列。只要种子确定了，PRNG 所生成的随机数就是完全确定的，因此其生成的随机数序列并不是真正随机的。
![[Pasted image 20241117131449.png]]

伪随机数生成器从一个初始种子值开始通过各种计算得到序列。通常伪随机数序列是递归地执行以下计算得到的：

$$S_{0}=seed$$

$$S_{i}+1\equiv f(S_{i}),i=0,1,\:.\:.$$

此表达式的一个推广形式就是 $S_{i+1}=f(s_i,s_{i-1},s_{i-2},...,s_{i-t})$ 所示的生成器，其中 t 是一个固定整数。

最常见的例子就是线性同余生成器（a，b，m 都是整型常量）：

$$S_{0}=seed$$

$$S_{i+1}\equiv(aS_{i}+b)\:mod\:m,i=0,1,2,\:.\:.\:.$$



## 反馈移位寄存器
在移位寄存器向右移位一位以后，左边就会空出一位（如上图所示），这时如果采用一个**反馈函数**，以寄存器中已有的某些序列作为反馈函数的输入，在函数中经过一定的运算后，将反馈函数输出的结果填充到移位寄存器的最左端，那么这样的移位寄存器就会有源源不断的输出。这样的，**拥有反馈函数的移位寄存器称为反馈移位寄存器**（Feedback Shift Register，FSR）
![[Pasted image 20240930110623.png]]

如果反馈移位寄存器的**反馈函数是线性函数**（即只进行简单线性运算的函数），那么这种寄存器就被称为**线性反馈移位寄存器（Linear Feedback Shift Register，LFSR）**。形如 $f(a_1,a_2,...,a_n){=}c_na_1\oplus c_{n-1}a_2\oplus...\oplus c_1a_n,c_i$ 为 0 或 1的函数称为线性反馈函数。不失一般性，我们可用+代替 $\oplus$。

形式地，用 $x^i$ 与 $s_i$ 相对应，则根据反馈函数可导出一
个文字 $x$ 的多项式：

$$g(x)=g_nx^n+g_{n-1}x^{n-1}+,...,+g_1x+g_0$$
称 g(x) 为线性移位寄存器的连接多项式。

只要选择合适的连接多项式便可使线性移位寄存器的输出序列周期达到最大值 $2^{n}-1$，并称此时的输出序列为最大长度线性移位寄存器输出序列，简称为 m 序列。

仅当连接多项式 g(x)为本原多项式时，其线性移位寄存器的输出序列为m序列。

#### 生成过程：
LFSR的反馈函数就是简单地**对移位寄存器中的某些位进行异或，并将异或的结果填充到LFSR的最左端**，如图所示。对于LFSR中每一位的数据，可以参与异或，也可以不参与异或。其中，我们把参与异或的位称为**抽头**。
![[Pasted image 20240930110850.png]]

如果移位寄存器中的值为 $\{b_1,b_2,\ldots,b_n\}$ ,则第 n+1 位的值可以表示为$b_{n+1}=c_1b_1\oplus c_2b_2\oplus\ldots\oplus c_nb_n$ ,其中 $b_i,i\in[1,n]$ 表示移位寄存器中的数据 (0 或 1); $c_i,i\in[1,n]$ 表示第 i 位**是否是抽头**，如果是，则 $c_i=1$ ,表示该位将参与运算；如果不是，则 $c_i=0$ ,表示该位将不参与运算。上式表示了 LFSR 的一种递推关系，在这个式子中，可以明显看出，$c_i$ 将抽头位选出并留下来参与运算，并且将不是抽头的位剔除掉。

**多项式表示**：
设线性反馈函数为 $f(a_1,a_2,...,a_n)=c_na_1+c_{n-1}a_2+...+c_1a_n$ 则输出序列 $\left\{a_i\right\}$ 满足：
$$a_{n+k}=c_1a_{n+k-1}+c_2a_{n+k-2}+\ldots+c_na_k$$
对任何 $k\textbf{1成 立 }$这种递推关系可用 $p(x)=1+c_1x+...+c_{n-1}x^{n-1}+c_nx^n$ 表示，称这个多项式为 LFSR 的特征多项式例：$f(a_1,a_2,a_3,a_4)=a_1+a_3+a_4$对应递推关系是 $p(x)=1+x^{5-4}+x^{5-3}+x^{5-1}=1+x+x^2+x^4$


一个 LFSR 由若干时钟存储原件（触发器）和一个反馈路径（有多种情况，但只能选择使用一种）组成。存储原件的数目给出了 LFSR 的度（级数）。一个拥有 m 个触发器的 LFSR 可以称为“度为 m”。也叫做我们的**级数**。在每个时钟周期内，内部状态位会右移一位，并执行 XOR 计算。以度 m=3为例，此时 LFSR 有三个触发器 FF0，FF1，FF2初始状态 s_0,𝑠_1,𝑠_2，以及如图的反馈路径。工作方式如下：

$s_{3}\equiv(s_{1}+s_{0})mod2$
$s_{4}\equiv ( s_{2}+ s_{1}) mod$ 2
$s_{5}\equiv ( s_{3}+ s_{2}) mod$ 2
$s_{i+ 3}\equiv ( s_{i+ 1}+ s_{i}) mod$ 2


如图显示了一个度为 m 的 LFSR 的通用形式。此 LFSR 拥有 m 个触发器和 m 个可能的反馈位置。反馈路径是否启用取决于反馈系数 $p_{0},\dots p_{m}$。如果对应的位置为 1，那么我们对应位置需要异或，否则不进行异或。

假设某个 LFSR 初始加载的值为 $s_0,s_1,...,s_{m-1}$，则 LFSR 的下一个输出位 $s_m$ 可以表示为：

$$s_m\equiv(s_{m-1}p_{m-1}+\ldots+s_1p_1+s_0p_0) mod 2$$

同理可推得下一个 LFSR 输出的计算式：

$$s_{i+m}\equiv \sum^{m-1}_{j=0}p_j\times s_{i+j}\space mod\space 2;s_i,p_j\in{0,1};i=0,1,2,...$$

## M 序列：
由于可重复性出现状态的数量有限，所以 LFSR 的输出序列会**周期性重复**。并且 LFSR 可以根据反馈系数的生成不同长度的输出序列，**LFSR 的最大长度**与其度 m 有关：$2^m−1$ 。
**只有设置特定的 $(p_0,p_1,...,p_{m-1})$ 才能得到最大长度的 LFSR**。

定义：n 级线性移位寄存器产生的序列 $\left\{a_i\right\}$ 的周期达到最大值 $2^n-1$ 时，称 ${a_i}$ 为 n 级 m 序列。$\mathbf{m}$ 序列的每个 n 长状态取遍 GF (2) $^\mathrm{n}$ 中的元素。$\mathbf{m}$ 序列可认为是“随机性最好”的序列。

$\mathrm{GF}(2)$ 上的 $n$ 级 $m$ 序列 $\{a_i\}$ 具有如下性质}:在一个周期内,0、1出现的次数分别为 $2^{n-1}-1$ 和 $2^{n-1}$。
在一个周期内,总游程数为 $2^{n-1}$;
对 $1 {\leq}i{\leq}n{-}2$,长为 $i$ 的游程有 $2^{n+1}$ 个,且 $0 \text、1$ 游程各半;
长为 $n-1$ 的 0游程一个,
长为 $n$ 的1游程一个。
自相关函数达到最佳值.


#### 特征多项式：
如果一个 LFSR 的第 n+1 位可以表示为 $b_{n+ 1}= c_1b_1\oplus c_2b_2\oplus \ldots \oplus c_nb_n$ (即上文提到的递推关系), 则这个递推关系可以对应一个特征多项式
$f(x)=c_nx^n+c_{n-1}x^{n-1}+\ldots+c_2x^2+c_1x^1+1$ ,(这里的 $c_i$ 与上文的 $c_i$ 相同),即只保留抽头位次项，最后还要加 1.

例：对于上图 9-4 中的 3 级 LFSR，其反馈函数为 $f(b_1,b_2,b_3)=b_1\oplus b_3$ ,则其特征多项式为

$$f(x)=x^3+x+1$$
每个 LFSR 有一个关联多项式，它与决定下一个移入位的函数不同。该多项式与 LFSR 的数学结果相关。特征式为：
$$p(x)=p_{n}x^{n}+p_{n-1}x^{n-1}+\ldots.+p_{i}x+1$$

我们先引入阶的概念：假设 $f(x)$ 是 $GF(2)$ 上的多项式，使 $f(x)|(x^n-1)$ 成立的最小的 n 即为这个多项式的阶。(这里的 n 与上文提到的级数 n 不是一回事) **阶往往也被称为周期**。如下图所示，有 $(x^4+x^3+x^2+x+1)|(x^5-1)$,故 $f(x)$ 的周期为5.
为了保证我们的伪随机数发生器的安全，我们希望我们的**LFSR**的特征多项式对应的周期为 $2^{m}-1$
。

M 序列 LFSR 反馈函数对应的特征多项式被称为本原多项式。

很明显，n 级 m 序列 LFSR 的本原多项式的阶一定为 $2^n-1$ 。

同理，如果一个 n 级 LFSR 的特征多项式的阶为 $2^n-1$ ,则这个多项式为本源多项式，并且这个LFSR 生成的序列为 m 序列。
例如，对于一个 3 级 LFSR，如果其反馈函数为 $f(x)=b_3\oplus b_1$ ,特征多项式为 $f(x)=x^3+x+1$ ,则有 $(x^3+x+1)|(x^7-1)$ ,其阶为 7，与 $2^3-1$ 相等。因此这个 LFSR 的周期为 7，其特征多项式为本原多项式，其生成的序列为 m 序列。

事实证明，如果 LFSR 的特征多项式是不可约分的（是一个**本原多项式**），那么 LFSR 就有一个最大的序列。如果不能约分了，且将 $p(x)$ 分为 $x^k-1$ 的最小整数 k 为 $2^n-1$，那么多项式的次数 n、 𝑝(𝑥)是基本的。

