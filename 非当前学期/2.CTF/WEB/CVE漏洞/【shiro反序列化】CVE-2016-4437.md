## Shiro 概述：
Apache [Shiro](https://so.csdn.net/so/search?q=Shiro&spm=1001.2101.3001.7020) 是一款开源安全框架，提供身份验证、授权、密码学和会话管理。Shiro 框架直观、易用，同时也能提供健壮的安全性。

Apache Shiro 1.2.4及以前版本中，加密的用户信息序列化后存储在名为 remember-me 的 Cookie 中。攻击者可以使用 Shiro 的默认密钥伪造用户 Cookie，触发 Java 反序列化漏洞，进而在目标机器上执行任意命令。

## 漏洞挖掘思路：
我们的 shiro 反序列化的问题出现在我们的 **remember me** 的情况下，这个时候会生成一个对应的 cookie，这个 cookie 相比较其他的信息很长，**并且我们的 cookie 一般包含了我们的序列化反序列化信息**。


这里，我们给出结论：我们的这一个**cookie**包含了我们的序列化信息，我们在解析我们的这一个 cookie 的时候，会首席那把我们的信息进行 base64 加密后，再去通过我们的 AES 加密，得到我们的解析后的结果。

那么，我们现在的关键就是怎么获取我们的 key，这里，我们的 AES 解密的 key，通过
![[Pasted image 20240503143214.png]]
来实现的。

![[Pasted image 20240503143233.png]]
而我们的对应的固定的字节是一个固定的值，我们注意到是一个固定的算法，于是，我们在固定的版本下，

## 利用：
我们先去构造一个带有目的功能的 payload
之后，我们再去把我们的 payload 用 AES 加密，
AES 加密后，我们再去通过我们的 base 64 加密
最后，我们在让他作为一个 cookie 来执行。
