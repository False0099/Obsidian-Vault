## 生产者消费者：
系统中有一组生产者进程和一组消费者进程，生产者进程每次生产一个产品放入缓冲区，消费者进程每次从缓冲区中取出一个产品并使用。(注：这里的“产品”理解为某种数据)

生产者、消费者共享一个初始为空、大小为 n 的缓冲区。
缓冲区没满之生产者生产。只有缓冲区没满时，生产者才能把产品放入缓冲区，否则必须等待。
只有缓冲区不空时，消费者才能从中取出产品，否则必须等待。缓冲区没空→消费者消费，缓冲区是临界资源，各进程必须互斥地访问。

这里，我们注意到：生产者和消费者访问我们的缓冲区是**互斥的**，
我们生产者只有在**队列不满**的情况下可以生产。
我们消费者只在**队列不空**的情况下可以消费。

而我们把上面的三个限制条件设置为三个信号量，分别是我们的：互斥关系量 `mutex`,非空信号量 `notempty` 非满信号量 `notfull`

![[Pasted image 20240502221408.png]]

**注意，我们要先检查是否满足执行条件的操作，再去抢占我们的互斥锁。**
![[Pasted image 20240502221719.png]]

```
semaphore mutex=1;
semaphore empty=n;
semaphore full=0;
producer(){
	P(full);
	P(mutex);
	v(mutex);
	v(empty);
}
Producer(){
	P(empty);
	P(mutex);
	v(mutex);
	v(full);
}
```

## 多生产者多消费者：
桌子上有一只盘子，每次只能向其中放入一个水果。爸爸专向盘子中放苹果，妈妈专向盘子中放橘子，儿子专等着吃盘子中的橘子，女儿专等着吃盘子中的苹果。只有盘子空时，爸爸或妈妈才可向盘子中放一个水果。仅当盘子中有自己需要的水果时，儿子或女儿可以从盘子中取出水果。用 PV 操作实现上述过程。
![[Pasted image 20240502222008.png]]
分析：
1. 父母子女对于我们的盘子的操作是互斥的
2. 只有我们的苹果不为空的时候，儿子才能拿
3. 只有我们的橘子不为空的时候，女儿才能拿
4. 只有我们的盘子不满的时候，我们才能放苹果
5. 只有我们的盘子不满的时候，我们才能放橘子

信号量：
1. mutex 控制我们的互斥
2. Orange_number 控制我们的橘子数量
3. Apple_number 控制我们的苹果数量
4. Sum_number 控制我们的盘子的总数
![[Pasted image 20240502222439.png]]

![[Pasted image 20240502222537.png]]


![[Pasted image 20240502222555.png]]


```
Semaphore mutex=1;
Semaphore orange_number=0;
Semaphore Apple_number=0;
Semaphore Left_number=1;

Father(){
	P(Sum_number);
	P(mutex);
	V(Apple_number);
	V(mutex);
}
Mother(){
	P(Left_number);
	
}

```

![[Pasted image 20240502222644.png]]

## 吸烟者问题：
![[Pasted image 20240502222945.png]]


![[Pasted image 20240502223215.png]]

## 读者写者问题：
![[Pasted image 20240505104944.png]]


![[Pasted image 20240505105231.png]]

## 哲学家吃饭问题：
![[Pasted image 20240505105744.png]]


![[Pasted image 20240507195305.png]]



24
回顾传统的哲学家问题，假设餐桌上有 $n$ 名哲学家、$n$ 根筷子，那么可以用这种方法避免死锁 (本书考点讲解中提供了这一思路): 限制至多允许 n-1 名哲学家同时“抢”筷子，那么至少会有 1 名哲学家可以获得两根筷子并顺利进餐，于是不可能发生死锁的情况。

本题可以用碗这个限制资源来避免死锁：当碗的数量 $m$ 小于哲学家的数量 $n$ 时，可以直接让碗的资源量等于 $m$,确保不会出现所有哲学家都拿一侧筷子而无限等待另一侧筷子进而造成死锁的情况；当碗的数量 $m$ 大于等于哲学家的数量 n 时，为了让碗起到同样的限制效果，我们让碗的资源量等于 $n-1$,这样就能保证最多只有 $n-1$ 名哲学家同时进餐，所以得到碗的资源量为 $\min\{n-1,m\}$。在进行 PV 操作时，碗的资源量起限制哲学家取筷子的作用，所以需要先对碗的资源量进行 P 操作。具体过程如下：
![[Pasted image 20240507195820.png]]
