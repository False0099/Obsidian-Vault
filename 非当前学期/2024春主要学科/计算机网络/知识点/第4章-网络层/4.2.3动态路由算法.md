## 链路状态（Link States）算法
链路状态路由算法要求每个参与该算法的结点都具有**完全的网络拓扑信息**，它们执行下述两项任务。第一，主动**测试所有邻接结点的状态**。两个共享一条链接的结点是相邻结点，它们连接到同一条链路，或者连接到同一广播型物理网络。第二，定期地**将链路状态传播给所有其他结点**(或称路由结点)。典型的链路状态算法是 OSPF 算法。

每当链路状态报文到达时，路由结点便使用这些状态信息去更新自己的网络拓扑和状态“视野图”,一旦链路状态发生变化，结点就对更新的网络图利用 Dijkstra 最短路径算法重新计算路由，从单一的源出发计算到达所有目的结点的最短路径。

### 工作过程
1. 获得整个**网络拓扑**, 网络中所有链路代价等信息（通过我们的链路状态分组泛洪来进行）
2. 用LS路由算法,计算本站点到其它站点的**最优路径**
3. （分组转发-数据平面）

### 链路状态路由选择 （LS）

生成**链路状态分组**（自己邻居的可达情况）、**泛洪**、Dijkstra算法（独立、迭代）

1. **发现**相邻节点，向所有线路发送HELLO分组，发送HELLO应答      
2. **测量**到相邻节点的代价(延迟,开销)——回送一个ECHO分组  
3. 组装一个分组，这个分组中应该描述的信息就包括：我们这一个结点是哪一个结点，我们和这一个结点相邻的边有哪些，我们这个结点对应的相邻的结点还有那些。描述相邻节点的情况——**链路状态分组**  
4. 将分组通过扩散的方法发到所有其它路由器——**泛洪**。避免广播风暴：设置 TTL（年龄字段）、记录转发情况（顺序号）保证收到，未收到确认信号就一直重复发送。——可靠泛洪。
5. 通过**Dijkstra**算法找出最短路径  

### 潜在问题：
讨论：可能会造成**震荡**。最快路径都去选择，下一周期就会拥塞。

## 距离-向量算法(DV)
RIP 要求自治系统 AS 内的每一个路由器都要维护从它自己到 AS 内其他每一个网络的距离记录。这是一组距离,称为“距离向量 D-V(Distance-Vector)

同时，我们采用我们的跳数作为衡量到达目的网络的距离。我们的路由器到直连网络的距离定义为 1. 路由器到非直连网络的距离定义为所经过的路由数+1.**最多只允许 15 个路由器**。
- 每个节点维护一张路由表：**目标、代价、下一跳邻居**。
- **只与相邻两邻居**，**定期**交换距离矢量 (包括到某个节点的距离，下一跳位置)。
- 根据获得的路由信息,更新自身的路由表，以及自身的**距离向量**。
### 工作过程：
第一步：路由器刚开始工作，只知道自己到直连网络的距离为 1.

第二步：每一个路由器仅和相邻路由器周期性的交换并更新我们的路由信息。

第三步：若干次交换和更新后，每一个路由器都知道到达本 AS 内各网络的最短距离和下一条地址，称为收敛。

### 更新规则：
在这种算法中，所有结点都必须参与距离向量交换，以保证路由的有效性和一致性，也就是说，所有的结点都监听从其他结点传来的路由选择更新信息，并在下列情况下更新它们的路由选择表：
1) 被通告一条新的路由，该路由在本结点的路由表中不存在，此时本地系统加入这条新的路由。

2) 发来的路由信息中有一条到达某个目的地的路由，该路由与当前使用的路由相比，有较短的距离 (较小的代价)。**并且吓一跳不相同**此种情况下，就用经过发送路由信息的结点的新路由替换路由表中到达那个目的地的现有路由。

3) 发来的路由信息有一条到达某个目的地址的路由，该路由**与当前的下一条相同**，这种情况下，我们可以**无条件更新我们的当前路由为新的路由**。

4) 如果我们到达的**下一跳**不同，但是**距离相同**, 我们就添加对应的表象，进行我们的**等价负载均衡**。
### 缺点：
无穷计算问题：
- 好消息传的快：好消息的传播以每一个交换周期前进一个路由器 的速度进行  
- 坏消息传的慢：断线会形成环路，每次迭代代价+1，无限次之后, 到A的距离变成INF,不可达  
![[Pasted image 20240701222132.png]]

处理策略：
1. **水平分裂**——可达信息来源邻居，对它表达自己到对应节点的可达信息为 INF。坏消息以一次交换一个节点的速度传播。（有环状链路的网络中就无能为力了）   
2. 限制最大路径距离为 15 (16 表示不可达)
3. **触发更新**——当路由表发生变化时就立即发送更新报文 (即“触发更新”), 而不仅是周期性发送。

## 层次路由：
当网络规模扩大时，路由器的路由表成比例地增大。这不仅会消耗越来越多的路由器缓冲区空间，而且需要用更多 CPU 时间来扫描路由表，用更多的带宽来交换路由状态信息。因此路由选择必须按照层次的方式进行。

因特网将整个互联网**划分为许多较小的自治系统** (注意一个自治系统中包含很多局域网), 每个自治系统有权自主地决定本系统内应采用何种路由选择协议。如果两个自治系统需要通信，那么就需要一种在两个自治系统之间的协议来屏蔽这些差异。

据此，因特网把路由选择协议划分为两大类：
1) 一个自治系统**内部**所使用的路由选择协议称为内部网关协议 (IGP), 也称域内路由选择，具体的协议有 RIP 和 OSPF 等。

2) 自治系统之间所使用的路由选择协议称为**外部网关协议**(EGP),也称域间路由选择，用在不同自治系统的路由器之间交换路由信息，并负责为分组在不同自治系统之间选择最优的路径。具体的协议有 BGP.

3) 使用层次路由时，OSPF 将一个自治系统再划分为若干区域(Area),每个路由器都知道在本区域内如何把分组路由到目的地的细节，但不用知道其他区域的内部结构。

4) 采用分层次划分区域的方法虽然会使交换信息的种类增多，也会使 OSPF 协议更加复杂。但这样做却能使每个区域内部交换路由信息的通信量大大减小，因而使 OSPF 协议能够用于规模很大的自治系统中。

