## 硬件设施：
WAN 口 (wide area network)：WAN 口是用于连接广域网的接口，通常连接到互联网服务提供商（ISP）提供的网络设备（如调制解调器）。WAN 口是路由器连接到外部互联网的入口。WAN 口将路由器连接到 ISP 的网络，实现局域网内设备与互联网的通信。路由器通过 WAN 口接收来自互联网的数据，并将其转换成局域网内设备可以识别的格式，同时将局域网内设备发送的数据转换并转发到互联网。**也就是我们常见的和外界连接的部分**。

LAN（Local area network） 口：LAN 口是用于连接局域网内设备的接口。局域网内的设备可以通过 LAN 口相互通信，并共享资源和互联网连接。通过 LAN 口，家庭或办公室内的计算机、打印机、智能电视等设备可以连接到路由器，形成一个局域网。LAN 口之间的数据交换通过交换机功能实现，允许局域网内设备之间高速通信。无线设备通过 Wi-Fi 接入局域网后，可以与通过 LAN 口连接的有线设备进行通信。**也就是我们常见的和外部连接的部分**。

## 定义：
路由器是一种具有多个输入/输出端口的专用计算机，其任务是连接不同的网络 (连接异构网络)并完成路由转发。在多个逻辑网络 (即多个广播域)互联时必须使用路由器。

当源主机要向目标主机发送数据报时，路由器先检查源主机与目标主机是否连接在同一个网络上。如果源主机和目标主机在同一个网络上，那么**直接交付**而无须通过路由器。如果源主机和目标主机不在同一个网络上，那么路由器按照转发表 (路由表)指出的路由将数据报转发给下一个路由器，这称为间接交付。可见，在同一个网络中传递数据无须路由器的参与，而跨网络通信必须通过路由器进行转发。例如，路由器可以连接不同的 LAN, 连接不同的 VLAN, 连接不同的 WAN, 或者把 LAN 和 WAN 互联起来。**路由器隔离了广播域**。

从结构上看，路由器由路由选择和分组转发两部分构成，如图 4.15 所示。而从模型的角度看，路由器是网络层设备，它实现了网络模型的下三层，即物理层、数据链路层和网络层。
![[Pasted image 20240702082711.png]]

## 两大功能：
1. 路由选择：根据路由选择协议（RIP）构造路由表，同时定期与相邻路由器交换信息而更新路由表（我们的路由表可以理解为数据库，当中包含我们目的主机所在地址，和我们的下一条地址）
![[Pasted image 20240415211148.png]]
2. 分组转发：交换结构根据转发表（根据路由表而来）转发分组，分组转发部分由三部分组成：交换结构、一组输入端口和一组输出端口。输入端口在从物理层接收到的比特流中提取出数据链路层帧，进而从帧中提取出网络层数据报，输出端口则执行恰好相反的操作。交换结构是路由器的关键部件，它根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输出端口转发出去。有三种常用的交换方法：通过存储器进行交换、通过总线进行交换和通过互联网络进行交换。交换结构本身就是一个网络。
![[Pasted image 20240415210629.png]]

## 交换结构（switch fabric）：
![[Pasted image 20240702195938.png]]

在我们的**数据被传输给下一个链路之前**，我们的整个分组必须到达路由器，然后再经过路由器的存储转发，类似于我们在**飞机厂内转机**。我们的**存储转发延时就是在这个时候产生的**。

我们的路由的交换结构，就是描述我们的任意两个路由器之间是按照何种方法来交换两者之间的数据的，我们的交换结构的作用是将我们的分组从输入缓冲区（路由器的一端）传输到合适的输出端口（路由器的另一端），
![[Pasted image 20240702091905.png]]
### 内存交换：
在 CPU 直接控制下的交换，采用传统的计算机思想。分组被**拷贝到系统内存**，CPU 从分组的头部提取出目标地址，查找转发表，找到对应的输出端口，拷贝到输出端口，转发速率被**内存的带宽限制** (数据报通过 BUS 两遍)，**一次只能转发一个分组**。

### 总线交换：
通过共享总线从输入端口存储器到输出端口存储器的数据报
总线争用：受总线带宽限制的切换速度
$\mathbf{1}$ 次处理一个分组32 Gbps 总线，

### 互联网络交换：
可以同时并发转发多个分组，克服总线带宽限制
Crossbar ( 纵横 ), 将多个处理器连接成多处理器当分组从端口 A 到达，转给端口 Y; 控制器短接相应的两个总线。
![[Pasted image 20240702092711.png]]

## 输出端口：
我们输出端口的结构如下图所示：
![[Pasted image 20240702092746.png]]

我们注意到，在我们的输出端口中，我们存在着一个缓冲队列，这一个队列就是我们的**输出端口**，在我们的输出端口，我们肯能会遇见下面的几个问题：
1. 传输速率大于我们的处理速率，我们的机器不能够及时的处理我们的当前的输入，这个时候，我们就要**设置缓冲区**。
2. 由调度规则选择排队的数据包进行我们的传输。

如果交换结构的转发速度慢于输入端口的总和，则输入队列可能会出现排队
·由于输入缓冲区溢出导致的排队延迟和丢失！
![[Pasted image 20240702092944.png]]

![[Pasted image 20240702093027.png]]
