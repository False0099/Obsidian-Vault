## 路由表与转发表
路由表是根据路由选择算法得出的，主要用途是路由选择。标准的路由表有 4 个项目：目的网络 IP 地址、子网掩码、下一跳 IP 地址、接口。在如图 4.16 所示的网络拓扑中，R1 的路由表见表 4.4,该路由表包含到互联网的默认路由。
![[Pasted image 20240702082859.png]]

![[Pasted image 20240702082851.png]]

转发表是从路由表得出的，其表项和路由表项有直接的对应关系。但转发表的格式和路由表的格式不同，其结构应使查找过程最优化(而路由表则需对网络拓扑变化的计算最优化)。转发表中含有一个分组**将要发往的目的地址**，以及分组的**下一跳**(即下一步接收者的目的地址，实际为 **MAC 地址**)。为了减少转发表的重复项目，可以使用一个默认路由代替所有具有相同“下一跳” 的项目，并将默认路由设置得比其他项目的优先级低。

注意，在讨论路由选择的原理时，往往不去区分转发表和路由表的区别，但要注意路由并不等于转发表。**分组的实际转发是靠直接查找转发表，而不是直接查找路由表**。

## 过程：
假设我们现在有两个网络，记为网络 `A`，和网络 `B`。我们的网络中的每一个设备，都通过我们的**路由器**相连接，我们的数据与数据之间**必须通过路由器**才能够交换数据。
![[Pasted image 20240527151607.png]]

首先，我们如果在**同一个网络内进行通信**，我们不需要操作，一条就能到达。因此，我们的第一个工作，就是要求判断我们通信的两个地址是否**在同一个网络内**。

而判断是否在同一个网络内，我们显然可以通过我们的目标的 IP 地址，与上**自己的子网掩码**，如果得到的结果都是相同的，说明在一个子网内。否则就不再一个网络内。
![[Pasted image 20240527151835.png]]


如果在不同的网络内，我们就需要**把我们数据传输给我们的路由器**，也叫做我们的**默认网关**。然后，我们的**默认网关**在把我们的数据转发给**其他路由器**。

**路由器收到数据包后**，首先判断是否出错，出错就打回去重传。否则我们就根据 IP 目的地址在路由表中查找对应的匹配条目，如果找到对应的匹配条目，就转发给下一跳，否则我们就丢弃该数据。
![[Pasted image 20240527152127.png]]


## 传递的信息
我们在前面的不点之后，我们不难发现，我们的每一次计算应当是输入一个子网编号，然后再通过我们的计算，得到我们的下一个子网编号。
![[Pasted image 20240516145651.png]]

步骤：
1. 取出我们的目的地址
2. 取出我们的子网掩码
3. 用我们的目的地址与我们的子网掩码进行与运算，如果我们已经是我们的目的地址，那么就按照对应的接口转发这一个数据包。（我们的表项中包括了我们的下一条的 mac 地址）
4. 否则我们就使用默认表象转发我们的数据包。我们