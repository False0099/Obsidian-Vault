## 划分子网的 IP 地址
两级 IP 地址的缺点：IP 地址空间的利用率有时很低；给每个物理网络分配一个网络号会使**路由表变得太大**而使网络性能变坏；两级的 IP 地址不够灵活。

从 1985 年起，在 IP 地址中又增加了一个“子网号字段”, 使两级 IP 地址变成了三级 IP 地址。这种做法称为子网划分。子网划分已成为因特网的正式标准协议。

子网划分的基本思路如下：
· 子网划分纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络。
· 从主机号借用若干比特作为子网号，当然主机号也就相应减少了相同的比特。三级 IP 地址的结构如下 : IP 地址 $= \{ <$ 网络号 > , < 子 网 号 > , < 主 机 号 > } $。$ 
·凡是从其他网络发送给本单位某台主机的 IP 数据报 , 仍然是根据 IP 数据报的目的网络号,先找到连接到本单位网络上的路由器。然后该路由器在收到 IP 数据报后，按目的网络号和子网号找到目的子网。最后把 IP 数据报直接交付给目的主机。


在这种方式下，我们的 IP 地址=网络号+子网号+主机号。而在我们的一个子网中我们就有着复杂的内容。
![[Pasted image 20240610145300.png]]


**我们的子网可以暂时理解为我们的省内快递，在我们的省内快递，我们可以通过我们的交换机来一部到达，而不需要进行我们的跨国快递**
### 子网掩码
而为了让我们的网络 `知道我们划分了子网，我们的多少位用于我们的划分子网`，我们需要通过我们的**子网掩码**，来告诉我们的网络，我们的 IP 地址中的哪些部分是我们的**子网**。

如果一个网络未划分子网，那么就采用默认子网掩码。A、B、C 类地址的默认子网掩码分别为255.0.0.0.255.255.0.0.255.255.255.0. 例如，某主机的 IP 地址 192.168.5.56, 子网掩码为 255.255.255.0, 进行逐位“与”运算后，得出该主机所在子网的网络号为 192.168.5.0。
![[Pasted image 20240610145511.png]]


![[Pasted image 20240527141444.png]]

32 比特的子网掩码可以表明分类 IP 地址的主机号部分被借用为了几个比特作为子网号，
![[Pasted image 20240527141604.png]]

只要我们把我们的 IPV 4 地址与我们的子网掩码进行逻辑与，就能够得到我们主机所在网络的网络号与子网号。其中，我们的**网络号依然由我们的网络类型来决定，我们是几类地址**。
![[Pasted image 20240610145746.png]]

### 无分类编制（CIDR）：
在我们的 CIDR 中，原则上是不存在我们的**传统的 A 类，B 类，C 类地址**。

CIDR 采用斜线记法，我们的斜线后面的数字表示我们的网络号占用的比特位数。我们的斜线后面的数字表示网络中的主机号。

CIDR 虽然不使用子网，但仍然使用“掩码”一词。“CIDR 不使用子网”是指 CIDR 并没有在 32 位地址中指明若干位作为子网字段。但分配到一个 CIDR 地址块的组织，仍可以在本组织内根据需要划分出一些子网。例如，某组织分配到地址块/20, 就可以再继续划分为 8 个子网 (从主机号中借用 3 位来划分子网), 这时每个子网的网络前缀就变成了 23 位。全 0 和全 1 的主机号地址一般不使用。
![[Pasted image 20240527142114.png]]

CIDR 地址块中的地址数一定是 2 的整数次幂，实际可指派的地址数通常为 $2^N-2$, $N$ 表示主机号的位数，主机号全 0 代表网络号，主机号全 1 为广播地址。网络前缀越短，其地址块所包含的地址就越多。

![[Pasted image 20240527142418.png]]


**注意：在我们的无分类编制中，仍然存在我们的全 0 全 1 为我们的保留位**。
## 路由聚合（构造超网）
我们的路由聚合也叫做构造超网，**这一个超网只是逻辑上存在，并不实际存在**。假设我们存在一个路由器 `R1` 与五个网路以及路由器 `R2` 直接相连，路由器 `R1` 和 `R2` 相邻，这个时候，在我们传递路由信息的时候，如果我们的 `R1` 直接把我们的所有信息都传输给我们的路由 `R2`，那么我们开销就会较大。
![[Pasted image 20240527142647.png]]

我们的路由聚合，也就是**找我们的各个网络的最长公共前缀，然后全部加起来合并为一个即可**。


![[Pasted image 20240527142743.png]]


![[Pasted image 20240610153046.png]]





