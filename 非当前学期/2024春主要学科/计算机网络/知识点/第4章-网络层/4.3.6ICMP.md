## 概述
ICMP，即网际控制报文协议（internet control message protocal）。我们的主机或者路由器可以通过 `ICMP` 来发送报告报文和差错询问报文。

ICMP 包围被封装在我们的 IP 协议当中，**作为我们的 IP 数据包的内容**。我们的 IP 协议为其添加一个
![[Pasted image 20240606170443.png]]

## 差错报告报文
我们的差错报告报文用于向我们的路由器主机报告我们的错误情况，我们会把我们的错误分成下面的几种类型：
1. 终点不可达： 当路由器或主机**不能交付** IP 数据包时，就向源点发送终点可达报文。具体可根据 ICMP 的代码字段细分。
![[Pasted image 20240606170659.png]]

2. 源点抑制：当路由器或注意由于**拥塞**而**丢弃**IP 数据包时，就会向该源点发送源点抑制报文，使源点知道应当把 IP 数据包的发送速率降慢。
![[Pasted image 20240606171019.png]]

3. 时间超过：由于在传输的过程中，我们的**TTL=0**, 这个时候，我们就会把我们的这一个数据包的对应的内容设置。使得源点知道这一个数据包被丢弃。
![[Pasted image 20240606171112.png]]


4. 参数问题：首部**出现误码**，直接丢弃这一个报文。
![[Pasted image 20240606171205.png]]
5. 改变路由（重定向）：因该**传送给其他的路由器**。
![[Pasted image 20240606171235.png]]

## 询问报文：
![[Pasted image 20240606171412.png]]

## 应用：
1. 分组网间探测 (ping)：测试路由器主机之间的连通性。
![[Pasted image 20240606171446.png]]


2. 跟踪路由：探测 IP 主机从源主机到目的主机需要经过哪些路由器。
![[Pasted image 20240606171552.png]]

原理：
![[Pasted image 20240606171635.png]]

![[Pasted image 20240606171658.png]]

![[Pasted image 20240606171720.png]]

