## 背景介绍：
DNS 解析过程涉及将主机名（例如 www.example.com ）转换为计算机友好的 IP 地址（例如 192.168.1.1）。

Internet 上的每个设备都被分配了一个 IP 地址，必须有该地址才能找到相应的 Internet 设备 - 就像使用街道地址来查找特定住所一样。当用户想要加载网页时，用户在 Web 浏览器中键入的内容（example. Com）与查找 example. Com 网页所需的机器友好地址之间必须进行转换。

连接到 Internet 的每个设备都有一个唯一 IP 地址，其他计算机可使用该 IP 地址查找此设备。DNS 服务器使人们无需存储例如 192.168.1.1（IPv 4 中）等 IP 地址或更复杂的较新字母数字 IP 地址，例如 2400:cb00:2048:1:: c 629: d 7 a 2（IPv 6 中）。

## 功能：
域名系统 (DNS) 是互联网的电话簿。人们通过例如 nytimes. Com 或 espn. Com 等域名在线访问信息。Web 浏览器通过互联网协议 （IP） 地址进行交互。DNS 将域名转换为 IP 地址，以便浏览器能够加载互联网资源。

![[Pasted image 20240525114054.png]]

## 域名结构：
首先，我们的**DNS 服务器**存在**不止一台**，而为了方便我们管理我们的域名，我们的域名系统**采用了树状结构**。我们的根节点就是我们的**根域名服务器（13 台）**，

为理解 DNS 解析过程，务必了解 DNS 查询必须通过的各种硬件设备。对于 Web 浏览器而言，DNS 查询是“在幕后”发生的，除了初始请求外，不需要从用户的计算机进行任何交互。

DNS 解析器 - 该解析器可被视为被要求去图书馆的某个地方查找特定图书的图书馆员。DNS 解析器是一种服务器，旨在通过 Web 浏览器等应用程序接收客户端计算机的查询。然后，解析器一般负责发出其他请求，以便满足客户端的 DNS 查询。

根域名服务器 - 根域名服务器是将人类可读的主机名转换（解析）为 IP 地址的第一步。可将其视为指向不同书架的图书馆中的索引 - 一般其作为对其他更具体位置的引用。

TLD 名称服务器 —— 顶级域名服务器（TLD）可看做是图书馆中一个特殊的书架。这个域名服务器是搜索特定 IP 地址的下一步，其上托管了主机名的最后一部分（例如，在 example. Com 中，TLD 服务器为 “com”）。

权威性域名服务器 - 可将这个最终域名服务器视为书架上的字典，其中特定名称可被转换成其定义。权威性域名服务器是域名服务器查询中的最后一站。如果权威性域名服务器能够访问请求的记录，则其会将已请求主机名的 IP 地址返回到发出初始请求的 DNS 解析器（图书管理员）。（存储着 xxx. Com）中 xxx 与 ip 地址的映射)

![[Pasted image 20240525114236.png]]

## 工作流程：
第一步：我们的用户通过浏览器访问对应的网站
第二步：**浏览器调用 DNS 客户端程序**，并向 DNS 服务器提出解析网站 IP 地址的请求。
第三步：**DNS 服务器**将网站的 IP 地址返回给浏览器
第四步：浏览器根据**IP 地址**向对应的地址**发送 HTTP 请求**。
第五步：WEB 服务器将对应的网页通过 HTTP 返回给我们的应用程序。

![[Pasted image 20240414163312.png]]


## DNS 查询的八个步骤：
我们的 DNS 解析的过程，就是从我们的网站中，**逐层抽取域名的过程**，
![[Pasted image 20240525114643.png]]

也就是每一次问有没有，没有再去根据我们的答案去寻找我们的结果。
![[Pasted image 20240525114728.png]]


#### DNS 递归查找的 8 个步骤：
1. 用户在 Web 浏览器中键入 “example.com”，查询传输到 Internet 中，并被 DNS 递归解析器接收。当用户在浏览器或其他网络应用中输入一个域名时，例如"example.com"，系统会向本地 DNS 服务器发出域名解析请求。本地 DNS 服务器是用户所在网络中的 DNS 服务器，通常由互联网服务提供商（ISP）或网络管理员配置。如果本地 DNS 服务器缓存了请求的域名解析结果，它会直接返回 IP 地址给用户。
![[Pasted image 20240328151517.png]]
2. 接着，如果本地 DNS 服务器没有缓存请求的域名解析结果，它会从根域名服务器（.）开始进行 DNS 递归查询。根域名服务器知道所有顶级域名（如 .com、.net、.org）的权威域名服务器的 IP 地址。
3. 然后，根服务器使用存储其域信息的顶级域（TLD）DNS 服务器（例如 .com 或 .net）的地址响应该解析器。在搜索 example.com 时，我们的请求指向 .com TLD。
4. 然后，解析器向 .com TLD 发出请求。
5. TLD 服务器随后使用该域的域名服务器 example.com 的 IP 地址进行响应。
6. 最后，递归解析器将查询发送到域的域名服务器。
7. example.com 的 IP 地址而后从域名服务器返回解析器。
8. 然后 DNS 解析器使用最初请求的域的 IP 地址响应 Web 浏览器。

我们 DNS 的递归查询，每一次询问**我们应该访问那一台服务器，从根节点开始询问直到我们的终点**。
![[Pasted image 20240314144523.png]]


而我们的递归与迭代结合的方式相对来说就好一点，我们每一次就这么问：
1. 我们问根域名服务器，告诉我以. Ask 结尾的域名服务器地址，并返回给我们的本地服务器
2. 我们询问我们的. Ask 服务器，要求他告诉我有以. Aks 1. Ask 结尾的地址，并返回给我们的本地域名服务器
3. 我们去询问我们的 Ask 1. Ask, 是否有我们的对应的 Ak 2. Aks 1. Ask 的地址，并返回给我们的本地服务器
4. 如果我们得到了我们的 Ask 2. Ask 1. Ask 的地址，那么我们就直接访问。
![[Pasted image 20240314144541.png]]
DNS 查找的这 8 个步骤返回 example.com 的 IP 地址后，浏览器便能发出对该网页的请求：

10. 浏览器向该 IP 地址发出 [HTTP](https://www.cloudflare.com/learning/ddos/glossary/hypertext-transfer-protocol-http/) 请求。
11. 位于该 IP 的服务器返回将在浏览器中呈现的网页（第 10 步）。

## DNS 缓存：
为了加快我们的 DNS 解析速度，我们可以采用我们的 DNS 缓存的方式来减少我们的用户对于 DNS 服务器的访问，从而减少我们的用户体验。

在拥有了 DNS 缓存后，我们就会**首先去访问我们的 DNS 缓存**，只有我们的**本地 DNS 缓存不存在**，我们才回去直接访问我们的 **DNS 缓存速度**。

我们的 DNS 缓存分为下面的几个层次：
1. 用户级别：我们在用户的电脑上会存储一些经常访问的域名的 IP 地址，
2. 服务器级别：
