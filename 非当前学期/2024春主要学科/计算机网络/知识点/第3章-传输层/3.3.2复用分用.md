## 为什么要分用复用
我们之所以要进行我们的分用与复用，是因为我们网络协议中的传输层对应了上层的**多个协议, 多个实体**，因此我们需要对我们的代码进行分用复用。

我们的接收端需要进行我们的**多路分用**，也就是依据头部信息将收到的 segment 交给正确的 socket，也就是不同的进程。

而我们的发送端需要进行**多路分用**，也就是为每一块数据封装上头部信息，**生成 segment**, 交给网络层。

复用和分用。复用是指发送方**不同的应用进程**都可使用**同一个传输层**协议传送数据;

分用是指接收方的传输层在剥去报文的首部后能够把这些数据**正确交付**到目的应用进程。

## 分用如何工作：
首先，我们的主机收到我们的 IP 数据报，每一个 IP 数据报携带源 IP 地址，目的 IP 地址，每一个数据报携带一个传输层的段 (segment) .每一个段携带源端口号和目的端口号。

之后，在我们的主机收到信息后，传输层协议将会提取我们的 IP 地址和端口号信息，将 Segment 导向对应的 socket，而我们的 TCP 就会进行更多的处理

### 无连接的分用：
我们在主机收到一个 UDP 后，我们会用一个**二元组表示**，也就是我们的 `（目的IP地址，目的端口号）`。将我们的 UDP 段绑向该端口号的 `socket`.来自不同源 IP 地址和源端口号的 IP 数据包会被导向同一个 Socket（**不存储我们的源 IP 地址，源目的端口**）
![[Pasted image 20240607200313.png]]

### 面向连接的分用：
我们在主机收到一个 TCP 后，我们会用一个四元组表示，也就是 `(源IP地址，源端口号，目的IP地址，目的端口号)`，接收端利用所有的四个值将 segment 导向合适的端口
![[Pasted image 20240607200520.png]]



首先，我们考虑如果我们向实现我们的端到端之间的通信，我们首先是需要公用一个最基本的地址**ip 地址**的，因此，我们在同一个时刻到达我们的某一个**ip 地址**的信息可能会非常非常多，这个时候，我们就需要**复用分用**技术。

![[Pasted image 20240425171239.png]]

## 复用技术
我们的复用技术是通过在我们的字段中先添加目的 ip 地址，当前的 IP 地址。然后 ![[Pasted image 20240425171543.png]]

![[Pasted image 20240425171651.png]]
