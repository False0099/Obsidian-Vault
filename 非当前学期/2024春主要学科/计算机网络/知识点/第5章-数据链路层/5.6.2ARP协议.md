## ARP 协议
### 背景
在我们的网络的应用过程中，我们通常会把一个 IP 地址和一个 MAC 地址之间建立起来我们的联系，这样，我们才能**准确的发送到我们的目标主机**。

那么，我们要怎么样在**已知同一局域网内某一个设备的 IP 地址的时候，求我们的 MAC 地址**。这是一位内我们的主机 A 要给我们的 B 发送我们的数据链路层的数据包，但是我们的主机 A 不知道我们的主机 B 的 MAC 地址，但是我们知道 B 的 IP 地址，这个时候，我们应该怎么样去处理？

实际上，我们会在我们的主机中，存储我们的 IP 地址和对印度个 MAC 地址的映射关系，我们叫做**ARP 高速缓存**。我们通过这样的存储，就可以直到我们的 ip 地址和我们的 mac 地址的对应关系。

但是，如果我们自始至终都没有这样的一条数据，我们应该怎么办呢？我们采用我们的下面的方法：

### ARP过程：
第一步：我们的 A 希望给我们的同一局域网内的 B 发送数据包，我们的 B 的 MAC 地址不在我们的 A 的 ARP 表中。这个时候，我们的 A 会**广播 ARP 查询分组，其中包含被查询节点的 IP** 地址。其中我们的**广播目的地址为 FF-FF-FF-FF-FF**。
![[Pasted image 20240627145513.png]]


第二步：我们的所有的点都会收到这个消息，而**只有 IP 地址匹配的主机**才会进行对应的回应，其他的主机都会丢弃我们的这一个报文。**IP 地址匹配的那一个主机**的对应的高速缓存表格当中，会把我们的 **A 的 MAC 地址**和**A 的 IP 地址**也存储到我们的对应的数据当中。
![[Pasted image 20240627145720.png]]

第三步：我们的对应的目的地址进行匹配，匹配上的地址，会在对应的**主机中添加一个对应的 IP 地址-MAC 地址的转换表**。

注意：我们的**arp**表格中包括我们的动态类型和我们的自动类型，对于我们的**动态类型**，我们是存在对应的生命周期的，默认事件是 2min。

**注意，我们的 ARP 理论上只能够在一个局域网内使用**。
![[Pasted image 20240627145950.png]]

通过我们的 ARP 的**广播**和对应的相应，我们的本地会学习我们的内容。

## 缺陷：
ARP 协议的缺陷在于，我们**没有对我们的返回报文进行身份验证**。于是我们可以伪造我们的对应的内容。[[嗅探器-数据收集]]中就会利用到我们的 ARP 欺骗，我们伪造一个

对于我们的 ARP 攻击的防御，我们就需要通过我们的对应的检查。