局域网(Local Area Network, LAN)是指在一个较小的地理范围(如一所学校)内，将各种计算机、外部设备和数据库系统等通过双绞线、同轴电缆等连接介质互相连接起来，组成资源和信息共享的计算机互联网络。

我们**每一次连接到一个 WiFi**其实就是连接到了一个**局域网当中**。我们的**无线接入点**AP 在连接的时候就已经创建了一个**局域网**，你的设备扫描并发现周围可用的 Wi-Fi 网络。连接成功后，无线接入点的 DHCP 服务器会给你的设备分配一个 IP 地址。设备**获得 IP 地址后，就成为这个局域网的一部分**，可以与网络中的其他设备进行通信。


主要特点如下：
1)为一个单位所拥有，且地理范围和站点数目均有限。
2)所有站点共享较高的总带宽 (即较高的数据传输速率)。
3)较低的时延和较低的误码率。
4)各站为平等关系而非主从关系。
5)能进行广播和组播。

其中，对于我们的**局域网的实现**不同，我们可以把我们的局域网分为下面的几种类型：
1. 以太网（目前使用最广泛的）：逻辑拓扑是总线型结构，物理拓扑是星形或扩展星形结构，
2. 令牌环（IEEE 802.5）：逻辑拓扑是环形结构，物理拓扑是星型结构
3. FDDI（IEEE 802.8）：逻辑拓扑是环形结构，物理拓扑是双环结构

## 以太网（LAN）
以太网逻辑上采用总线形拓扑结构，以太网中的所有计算机共享同一条总线，信息以广播方式发送。为了保证数据通信的方便性和可靠性，以太网简化了通信流程并**使用了 CSMA/CD 方式**对总线进行访问控制。

以太网采用两项措施以简化通信：
1. 采用**无连接**的工作方式，不对发送的数据帧编号，也不要求接收方发送确认，即以太网尽最大努力交付数据，提供的是不可靠服务，对于差错的纠正则由高层完成；
2. 发送的数据都使用曼彻斯特编码的信号，每个码元的中间出现一次电压转换, 接收端利用这种电压转换方便地把位同步信号提取出来。

### 介质：
在我们的以太网中，我们一般有下面的四种介质：粗缆，细览，双绞线，光纤。
![[Pasted image 20240701195932.png]]

同时，我们的设备如果想要连接上我们的以太网，我们还需要通过我们的网络连接板或者我们俗称的**网卡**，全世界的每块网卡在出厂时都有一个唯一的代码，称为介质访问控制(MAC)地址，这个地址用于控制主机在网络上的数据通信。数据链路层设备(网桥、交换机等)都使用各个网卡的 MAC 地址。另外，网卡控制着主机对介质的访问，因此网卡也工作在物理层，因为它只关注比特，而不关注任何地址信息和高层协议信息。

我们的 MAC 地址不止存在于我们的一般的网络中，也包括我们的那些**蓝牙设备**。

### MAC 帧：
**我们的帧定界符不属于我们的 MAC 帧的内容**。我们的具体格式如下所示，我们的 MAC 帧，同样由我们的**头部**+数据段+**尾部**来实现。

### 头部结构：
我们的 MAC 帧当中的头部结构包括我们的目的地址，起始地址，类型，其中我们的目的地址是一个 MAC 地址，起始地址也是一个 MAC 地址。我们的**类型字段**告诉我们的上一层，我们采用网络层的什么协议。
![[Pasted image 20240701201730.png]]

### 数据
注意，我们的**数据部分最小长度是 46 B**，这是因为我们的数据部分必须满足我们的**CSMA/CD**协议当中的要求，也就是我们的传输时间 $\geq 2\times$ 传播时间。并且还要**减去我们的头部和尾部**。并且还要求我们的数据部分**最大长度为 1500 B**。
如果我们的上一层的数据**不足 46 B**，我们需要补充，使之达到我们的**46 B**的大小。

### 尾部：
我们的 MAC 帧的尾部包括我们的**校验码**，我们的**校验范围**从我们的目的地址段到我们的数据段的末尾。**也就是我们的全部报文**。但是不检验我们的**签到吗**，我们的尾部字段一般长度都是我们的**4 B**。


## 802.11 局域网（WAN）
无线局域网可分为两大类：有固定基础设施的无线局域网和无固定基础设施的移动自组织网络。所谓“固定基础设施”, 是指预先建立的、能覆盖一定地理范围的**固定基站**。

### 固定基站（路由器）：
对于有固定基础设施的无线局域网，IEEE 制定了无线局域网的 802.11 系列协议标准，包括802.11a/b/g/n 等。802.11 使用星形拓扑，其**中心称为接入点**（路由器中的 WAN 口）(Access Point,AP),在 MAC 层使用 CSMA/CA 协议。使用 802.11 系列协议的局域网又称 Wi-Fi.

无线接入点通过有线连接（如以太网电缆）连接到互联网服务提供商（ISP）的调制解调器，从而提供互联网接入。

802.11 标准规定无线局域网的最小构件是基本服务集 BSS(Basic Service Set, BSS)。一个基本服务集包括**一个接入点和若干移动站**。各站在本 BSS 内之间的通信，或与本 BSS 外部站的通信，都必须通过本 BSS 的 AP。

AP 就是基本服务集中的基站(base station)。安装 AP 时，必须为该 AP 分配一个不超过 32 字节的服务集标识符(Service Set IDentifier, SSID)和一个信道。

SSID 是指使用该 AP 的无线局域网的名字。（**WIFI 名字**）一个基本服务集覆盖的地理范围称为一个基本服务区(Basic Service Area, BSA),无线局域网的基本服务区的范围直径一般不超过 100m。

### 无固定基站（热点）：
另一种无线局域网是无固定基础设施的无线局域网，又称自组网络(ad hoc network)。自组网络没有上述基本服务集中的 AP,而是由一些平等状态的移动站相互通信组成的临时网络(见图 3.28)。各结点之间地位平等，中间结点都为转发结点，因此都具有路由器的功能。

### MAC 帧：
在我们的 802.11 中，由于我们的协议是**面向连接**的协议，所以我们的帧也对应添加了许多类型，包括我们的数据帧，控制帧，管理帧。

#### 数据帧：
我们的数据帧由我们的下面的几个部分组成： MAC 首部，帧数据，检验序列
![[Pasted image 20240701203241.png]]

我们的 MAC 帧当中 MAC 首部包括下面的内容：
1. 帧控制标识（2 B）：
2. 持续地址
3. 地址 1
4. 地址 2
5. 地址 3
6. 序号控制
7. 地址 4

其中我们**最重要的是我们的四个地址字段**，其中我们的第四个地址用于我们的**自组网络**，剩下的三个地址取决于我们的**帧标识控制字段**中的标识，我们的答案如下：
![[Pasted image 20240701203412.png]]


地址 1 是**直接接收数据帧**的结点地址，地址 2 是**实际发送**数据帧的结点地址。
1) 现假定在一个基本服务集中的站 A （手机 A）向站 B（手机 B） 发送数据帧。在站 A 发往接入点 AP 的数据帧的帧控制字段中，“去往 AP=1”而“来自 AP=0”; 地址 1 是 AP 的 MAC 地址，地址 2 是 A 的 MAC 地址，地址 3 是 B 的 MAC 地址。注意，“接收地址”与“目的地址”并不等同。

2) AP 接收到数据帧后，转发给站 B, 此时在数据帧的帧控制字段中，“去往 AP=0”而“来自 AP=1”; 地址 1 是 B 的 MAC 地址，地址 2 是 AP 的 MAC 地址，地址 3 是 A 的 MAC 地址。请注意，“发送地址”与“源地址”也不等同。


**无线客户端 A 发送数据到无线客户端 B，通过无线接入点 AP**：
- **无线客户端A到AP**：
    - **RA**：AP的MAC地址
    - **TA**：无线客户端A的MAC地址
    - **DA**：无线客户端B的MAC地址
    - **SA**：无线客户端A的MAC地址
- **AP到无线客户端B**：
    - **RA**：无线客户端B的MAC地址
    - **TA**：AP的MAC地址
    - **DA**：无线客户端B的MAC地址
    - **SA**：无线客户端 A 的 MAC 地址

下面讨论一种更复杂的情况。在图 3.30 中，两个 AP 通过有线连接到路由器，现在路由器要向站 A 发送数据。路由器是网络层设备，它看不见链路层的接入点 AP,只认识站 A 的 IP 地址。而 AP 是链路层设备，它只认识 MAC 地址，并不认识 IP 地址。
![[Pasted image 20240701204350.png]]

1) 路由器从 IP 数据报获知 A 的 IP 地址，并使用 ARP 获取站 A 的 MAC 地址。获取站 A 的 MAC 地址后，路由器接口 R 1 将该 IP 数据报封装成 802.3 帧 (802.3 帧只有两个地址),该帧的源地址字段是 R 1 的 MAC 地址，目的地址字段是 A 的 MAC 地址。
2) AP 收到该 802.3 帧后，将该 802.3 帧转换为 802.11 帧，在帧控制字段中，“去往 AP=0”而“来自 AP=1”; 地址 1 是 A 的 MAC 地址，地址 2 是 AP 的 MAC 地址，地址 3 是 R 1 的 MAC 地址。这样，A 可以确定 (从地址3将数据报发送到子网中的路由器接口的 MAC 地址。