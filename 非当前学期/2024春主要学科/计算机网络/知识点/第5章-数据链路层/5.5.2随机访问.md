## 随机访问介质访问控制：
在随机访问协议中，不采用集中控制方式解决发送信息的次序问题，**所有用户能根据自己的意愿随机地发送信息**，占用信道全部速率。在总线形网络中，当有两个或多个用户同时发送信息时，就会产生帧的冲突 (碰撞，即前面所说的相互干扰), 导致所有冲突用户的发送均以失败告终。为了解决随机接入发生的碰撞，每个用户需要**按照一定的规则反复地重传它的帧，直到该帧无碰撞地通过**它们的核心思想都是：**胜利者通过争用获得信道**，从而获得信息的发送权。因此，随机访问介质访问控制协议又称争用型协议。

### ALOHA 协议
我们的 aloha 协议的基本思想是：当网络中的一个结点需要发送数据时，可以不进行任何检测就发送数据。如果一段时间内收到确认，那么就认为发生了冲突，这个时候再去进行重传。
![[Pasted image 20240625111139.png]]

#### 时隙 ALOHA 协议
我们的时隙 ALOHA 协议，时隙 ALOHA 协议把所有各站在时间上同步起来，并将时间划分为一段段等长的时隙 (Slot), 规定**只能在每个时隙开始时才能发送一个帧**。从而避免了用户发送数据的随意性，减少了数据产生冲突的可能性，提高了信道的利用率。
![[Pasted image 20240625111403.png]]



## CSMA 协议：
我们的 CSMA 协议化成一句话就是说：**先侦听一下共用信道，发现信道空闲后再发送**，则就会大大降低冲突的可能，从而提高信道的利用率。

我们的协议分为三类：1-坚持 CSMA，非坚持 CSMA，P-坚持 CSMA
### 1-坚持 CSMA
1-坚持 CSMA (1-persistent CSMA)的基本思想是：一个结点要发送数据时，首先侦听信道；如果**信道空闲，那么立即发送数据**；如果信道**忙，那么等待**，同时继续侦听直至信道空闲；如果发生冲突，那么随机等待一段时间后，再重新开始侦听信道。
“1-坚持”的含义是：侦听到信道忙后，继续坚持侦听信道；侦听到信道空闲后，发送帧的概率为 1, 即立刻发送数据。

传播延迟对 1-坚持 CSMA 协议的性能影响较大。

例如：结点 A 开始发送数据时，结点 B 也正好有数据要发送，但这时结点 A 发出数据的信号还未到达结点 B, 结点 B 侦听到信道空闲，于是立即发送数据，结果必然导致冲突。即使不考虑延迟，1-坚持 CSMA 协议也可能产生冲突。例如，结点 A 正在发送数据时，结点 B 和 C 也准备发送数据，侦听到信道忙，于是坚持侦听，结果当结点 A 一发送完毕，结点 B 和 C 就会立即发送数据，同样导致冲突。

### 非坚持 CSMA
非坚持 CSMA (Non-persistent CSMA)的基本思想是：一个结点要发送数据时，首先侦听信道；如果信道空闲，那么立即发送数据：**如果信道忙，那么放弃侦听，等待一个随机的时间后再重复上述过程**。

非坚持 CSMA 协议在侦听到信道忙后就放弃侦听，因此降低了多个结点等待信道空闲后同时发送数据导致冲突的概率，但也会增加数据在网络中的平均延迟。可见，信道利用率的提高是以增加数据在网络中的延迟时间为代价的。

### p-坚持 CSMA
$p$ -坚持 CSMA(P-persistent CSMA)用于时分信道，其基本思想是：一个结点要发送数据时，首先侦听信道；如果信道忙，就持续侦听 $^\mathrm{\upsilon}$,直至信道空闲；如果信道**空闲**，那么**以概率 $p$ 发送数据**，以概率 $1-p$ 推迟到下一个时隙。

## CSMA/CD 协议
载波侦听多路访问/碰撞检测(Carrier Sense Multiple Access with Collision Detection, CSMA/CD) 协议是 CSMA 协议的改进方案，适用于总线形网络或半双工网络环境。“载波侦听”就是**发送前先侦听**，即每个站在发送数据之前先要检测一下总线上是否有其他站点正在发送数据，若有则暂时不发送数据，等待信道变为空闲时再发送。“碰撞检测”就是**边发送边侦听**，即适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站点是否也在发送数据。

我们的流程如下所示：
1)适配器从网络层获得一个分组，**封装成以太网帧**，放入适配器的缓存，准备发送。

2)如果适配器侦听到信道**空闲**，那么它开始发送该帧。如果适配器侦听到信道忙，那么它**持续侦听**直至信道上没有信号能量，然后开始发送该帧。

3)在发送过程中，适配器持续**检测信道**。若一直未检测到碰撞，则顺利地把这个帧发送完毕。若检测到碰撞，则中止数据的发送，并发送一个拥塞信号，以让所有用户都知道。（**这里我们的碰撞可以理解为一个高电压**）

4)在中止发送后，适配器就执行指数退避算法，**等待一段随机时间后返回到步骤 2)**。


注意，我们的该种方法是不支持**全双工通信的**，因为我们某一个站点不能同时发送和接收。数据在我们的中途会**发生冲突**。
### 计算：
### 最小帧长：
并且，我们还可以知道，我们的某一个点在发送数据后，**最多经过 2r**能够直到我们的发送的帧有没有发生碰撞。因此我们就把我们的 $2r$ 叫做我们的**争用期**。也就是说，只有在超过 $2t$ 时间内没有收到碰撞信号，才能**确定没有发生碰撞**。

因此我们的帧的**传输时延**至少要两倍于信号在总线中的**传播时延**，所以 CSMA/CD 总线网中的所有数据帧都必须要大于一个最小帧长。因此任何站点收到帧长**小于最小帧长的帧时，就把它当作无效帧立即丢弃**。最小帧长的计算公式为
最小帧长 = 总线传播时延 x 数据传输速率（数据传输速率表示我们单位时间能把多少个人送上马路） x2

![[Pasted image 20240625115006.png]]
#### 退避算法（）：
除检测冲突外，CSMA/CD 还能从冲突中恢复。一旦发生了冲突，参与冲突的两个站点紧接着再次发送是没有意义的，如果它们这样做，那么将会导致无休止的冲突。CSMA/CD 采用**二进制指数退避算法**来解决碰撞问题。算法精髓如下：
1)确定基本退避时间，一般取两倍的总线端到端传播时延 2 $\tau$ (即争用期)。
2)定义参数 $k$,它等于重传次数，但 $k$ **不超过 10**, 即 $k=\min[$ 重传次数，10]。当重传次数不超过 10 时，$k$ 等于重传次数；当重传次数大于 10 时，$k$ 就不再增大而一直等于 10 (这个
条件往往容易忽略，请读者注意)。

3)从离散的整数集合 $[0,1\cdots, 2^k-1]$ 中**随机取出一个数 r**, 重传所需要退避的时间就是 r 倍的基本退避时间，即 2  $\tau$。

4)当**重传达 16 次仍不能成功时**，说明网络太拥挤，认为此帧永远无法正确发出，**抛弃此帧**并向高层报告出错 (这个条件也容易忽略，请读者注意)。


### 用途：
我们的 CSMA/CD 协议主要用于我们的使用有线连接的局域网当中

## CSMACA
CSMA/CD 协议已成功应用于使用有线连接的局域网，但在无线局域网环境下，却不能简单地搬用 CSMA/CD 协议，特别是碰撞检测部分。主要有两个原因：
1)接收信号的强度往往**会远小于发送信号的强度**，且在无线介质上信号强度的动态变化范围很大，因此若要实现碰撞检测，则硬件上的花费就会过大。
2)在无线通信中，并非所有的站点都能够听见对方，即存在“隐蔽站”问题。

为此，802.11 标准定义了广泛应用于无线局域网的 CSMA/CA 协议，它对 CSMA/CD 协议进行了修改，把碰撞检测改为**碰撞避免** (Collision Avoidance, CA)。

“碰撞避免”并不是指协议可以完全避免碰撞，而是指协议的设计要尽量降低碰撞发生的概率。由于 802.11 无线局域网不使用碰撞检测，一旦站点开始发送一个帧，就会完全地发送该帧。

但碰撞存在时仍然发送整个数据帧 (尤其是长数据帧)会严重降低网络的效率，因此要采用碰撞避免技术降低碰撞的可能性。

由于无线信道的通信质量远不如有线信道，802.11 使用链路层确认/重传 (ARQ)方案，即站点每通过无线局域网发送完一帧，就要在收到对方的确认帧后才能继续发送下一帧。

为了尽量避免碰撞，802.11 规定，所有的站完成发送后，必须再**等待**一段很短的时间(继续监听)才能发送下一帧。这段时间称为帧间间隔(InterFrame Space,IFS)。帧间间隔的长短取决于该站要发送的帧的类型。

## 发送流程：
第一步：发送方向我们的木地方发送一个数据帧，如果检测到我们的信道空闲，那么我们在等待一个数据间隔 $DIFS$ 后，发送我们的第一个时间帧。**DIFS**是为了满足我们的高优先级的先进性操作。

第二步：我们的目的方如果正确收到了这一个帧，需要等待一个数据间隔 $SIFS$ 后，向我们的发送方返回一个 ACK 信号，如果我们的发送方没有受到我们的 ACK 信号，我们就重新操作。**SIFS**是为了让我们的发送方转变为接收方而等待的时间。

第三步：如果在数据忙的时候，我们就等待我们的空闲之后，在等待我们的一个**DIFS**时间后，**再去等待一个随机事件 t**，然后再去发送下一帧。

当站点检测到信道是空闲的,并且所发送的数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧

### 退避算法
在执行退避算法时，站点为退避计时器设置一个随机的退避时间。
当退避计时器减小到 0 时，就开始发送数据；
当退避计时器时间还未减少到 0 时，信道又转变为忙状态，这时就冻结退避计时器的数值，等到变为空闲，**又经过了 DIFS 事件后**，我们继续启动退避计时器。
在进行第 i 次退避时，退避时间在时隙编号{$\{0,1,...,2^{2+\mathrm{i}}-1\}$ 中随机选择一个，然后乘以基本退避时间 (也就是一个时隙的长度)就可以得到随机的退避时间。这样做是为了使不同站点选择相同退避时间的概率减少。当时隙编号达到255时(对应于第6次退避)就不再增加了。

![[Pasted image 20240701192253.png]]
