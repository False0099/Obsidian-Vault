## 可靠传输原理
07.[2017 统考真题]甲乙双方均采用后退 $N$ 帧协议 (GBN)进行持续的双向数据传输，且双方始终采用捎带确认，帧长均为 1000 B。$S_\mathrm{xy}$ 和 $R_\mathrm{xy}$ 分别表示甲方和乙方发送的数据帧，其中 $x$ 是发送序号，$y$ 是确认序号 (表示希望接收对方的下一帧序号), 数据帧的发送序号和确认序号字段均为 3 比特。信道传输速率为 100 Mb/s, RTT=0.96 ms。下图给出了甲方发送数据帧和接收数据帧的两种场景，其中 $\iota_0$ 为初始时刻，此时甲方的发送和确认序号均为 $0,t_1$ 时刻甲方有足够多的数据待发送。请回答下列问题。
![[Pasted image 20240702232351.png]]
1)对于图 (a), $\iota_0$ 时刻到 $\iota_1$ 时刻期间，甲方可以断定乙方已正确接收的数据帧数是多少？正确接收的是哪几个帧 (请用 $S_\mathrm{xy}$ 形式给出)?
2)对于图 (a), 从 $\iota_1$ 时刻起，甲方在不出现超时且未收到乙方新的数据帧之前，最多还可以发送多少个数据帧？其中第一个帧和最后一个帧分别是哪个 (请用 $S_\mathrm{xy}$ 形式给出)?

关于我们的 $GBN$ 算法，我们的第一步都是要先去计算出我们的**最大窗口大小**，采用后退 N 帧协议 (GBN),发送窗口大小 $W_T$ 满足 $1<W_T\leq2^n-1$ ,接受窗口大小 $W_R$ 满足 $W_R=1$。

其中 $n$ 是帧序号的比特数。将 $n=3$ 代入，$1<W_T\leq7$ 。发送窗口最大为7。可以有 $2^3=8$ 个帧序号，即帧编号 $0\sim7$。

（1）第一问。$t_0$ 时刻到 $t_1$ 时刻期间，根据乙发送最后一个帧 $R_{3,3}$ ,表示乙希望甲发送 3 号帧，后退 N 帧协议 (GBN)为累积确认，表明乙已经正确接收甲发送的 0~2 号帧，tO 时刻到 t 时刻期间，甲方可以断定乙方已正确接收了3个数据帧。

第二问。此时甲已经发送 $S_{0,0},S_{1,0},S_{2,0},S_{3,0}$ 和 $S_{4,1}$ ,甲发送的 0~2 号帧对应 $S_{0,0},S_{1,0},S_{2,0}$ ,即正确接收的是 $S_{0,0},S_{1,0},S_{2,0}$ .

（2）第一问。甲的发送窗口最大为 7，在 $t_1$ 时刻前，甲已经发送 $S_{0,0},S_{1,0},S_{2,0},S_{3,0}$ 和 $S_{4,1}$ 共计 5 个数据帧，其中乙方已正确接收了 3 个数据帧，还剩 2 个数据帧情况未知，这 2 个帧序号依次是 3、 4, 甲可以将发送窗口中的剩余 7-2=5 个帧全部发送出去，即从 $t_{1}$ 时刻起，甲方最多还可以发送 5 个数据帧，这 5 个帧序号依次是 5、6、7、0、1。
![[Pasted image 20240702233015.png]]

第二问。甲收到乙发来的 $R_{0,1},R_{1,3},R_{3,3}$ ,即乙发来的0、1、3号帧，其中 $S_{4,1}$ 对 $R_{0,1}$ 进行了确认，即乙发来的0号帧已经被确认，剩余1、3号帧需要确认，因为后退 N 帧协议 (GBN)为累积确认，3号帧没有按序发送，所以甲正确接收乙发来的1号帧，希望接收乙发来的2号帧，所以甲方在不出现超时且未收到乙方新的数据帧之前，可以发送的数据帧为 $S_{5,2},S_{6,2},S_{7,2},S_{0,2},S_{1,2}$ 。其中第一个帧是 $S_{5,2}$ ,最后一个帧是 $S_{1,2}$ 。

（3）第一问。在 $t_1$ 时刻前，甲已经发送 $S_{0,0},S_{1,0},S_{2,0},S_{3,2}$ 和 $S_{4,2}$ 共计 5 个数据帧，表明甲发送了 0~5 号数据帧，最后收到乙发送的 $R_{2,2}$ 数据帧，表明乙已经正确接收甲发送的 0~1 号数据帧，希望接收甲发送的 2 号数据帧，因为 $S_{2,0}$ 超时，需要发送出错帧及其之后的帧，即甲需要重传 2~4 号数据帧，即从 $t_{1}$ 时刻起，甲方在不出现新的超时且未收到乙方新的数据帧之前，需要重发3个数据帧。
第二问。$t_1$ 时刻前，甲已经正确接收 $R_{2,2}$ ,即乙发来的 2 号数据帧，希望接收乙发来的 3 号数据帧，甲需要重传 2~4 号数据帧，第一个需要重传的是 2 号数据帧，因此，甲重发的第一个帧是 $S_{2,3}$