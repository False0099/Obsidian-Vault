## 距离向量：
![[Pasted image 20240702164458.png]]

![[Pasted image 20240703000425.png]]
答案：（9，20，28，20），自己画表算一下就行。

【47】（9 分）假设 Internet 的两个自治系统构成的网络如题47图所示，自治系统 AS1由路由器 R1连接两个子网构成；自治系统 AS2由路由器 R2、R3互联并连接3个子网构成。各子网地址、R2的接口名、R1与 R3的部分接口 IP 地址如题47图所示。
![[Pasted image 20240703004207.png]]

1）假设路由表结构如下表所示。请利用路由聚合技术，给出 R2的路由表，要求包括到达题47图中所有子网的路由，且路由表中的路由项尽可能少。

| 接口  | 目的网络 | 下一跳 |
| --- | ---- | --- |

2）若R2收到一个目的IP地址为194.17.20.200的IP分组，R2会通过哪个接口转发该IP分组？

3）R1与R2之间利用哪个路由协议交换路由信息？该路由协议的报文被封装到哪个协议的分组中进行传输？

答：
（1）：
R2经接口S0下一跳至153.14.3.2，交由 R1转发；  
R2经接口E0下一跳至194.17.20.128/25，直接连接；  
R2经接口S1下一跳至194.17.24.2，交由R3转发，
所以

|目的网络|下一跳|接口|
|---|---|---|
|R1连接的网络|153.14.3.2|S0|
|194.17.20.128/25|直接连接，无下一跳|E0|
|R3连接的网络|194.17.24.2|S1|

「**路由表中的路由项尽可能少**」，所以需要将R1连接的网络合并，R3连接的网络合并。

将R1连接的网络合并：

|155.14.5.0/25|155.14.5.0 0000000 /25|
|---|---|
|153.14.5.128/25|153.14.5.1 0000000 /25|
|合并后|155.14.5.0/24|

将R3连接的网络合并

| 194.17.00010100. 0 0000000/25 | 194.17.20.0/25 |
| ----------------------------- | -------------- |
| 194.17.00010101. 00000000/24  | 194.17.21.0/24 |
| 194.17.0001010 0.0/23         | 合并后         |
| 194.17.20.0/23                |                |

最终路由表为

| 接口  | 下一跳         | 目的网络             |
| --- | ----------- | ---------------- |
| S0  | 153.14.3.2  | 155.14.5.0/24    |
| E0  | 直接连接，无下一跳   | 194.17.20.128/25 |
| S1  | 194.17.24.2 | 194.17.20.0/23   |


（2）我们两者之间显然根据我们的路由表去判断即可。

3） R1和 R2分处于两个不同的自治系统（AS）。自治系统内一般使用 RIP 或者 OSPF。自治系统之间一般使用边界网关协议 BGP-4，所以 R1和 R2之间利用 BGP-4交换路由信息；BGP-4报文被封装在 TCP 报文段中进行传输。


## 外部网关协议：
![[Pasted image 20240702164702.png]]



（1）因为我们希望直达的是**跨越自治系统的路由协议**，于是我们就需要通过我们的跨越边界的路由协议，也就是我们的 `eBGP` 来获得我们的信息。

（2）因为我们的 $R_{3}a$ 与我们的 X 不相邻，我们的位置，就是我们的 $AS_{4}$ 通过 EBGP 协议首先把信息告诉我们的 $R_{3}C$，我们的 $R_{3}C$ 再通过 IBGP 告知我们的 $R_{3}A$

(3) ![[Pasted image 20240702164943.png]]

![[Pasted image 20240702165055.png]]
(1)在我们的网络内部，我们遵循我们的内部协议，因为我们的对应的采用的是 RIP 协议，我们选择**跳数最少的**，因此我们选择我们的接口 1.
（2）
BGP-4 中我们路径选择存在优先级：
1. 条数少的
2. 热土豆算法（尽快离开本 AS）

## 路由表：
**我们的路由表中的信息都是存放我们的网络号的 IP 地址**。

![[Pasted image 20240702170120.png]]

![[Pasted image 20240702170356.png]]

47.（9 分）某网络拓扑如下图所示，路由器 R 1 通过接口 E 1、E 2 分别连接局域网 1、局域网 2，通过接口 L 0 连接路由器 R 2，并通过路由器 R 2 连接域名服务器与互联网。R 1 的 L 0 接口的 IP 地址是 202.118.2.1；R 2 的 L 0 接口的 IP 地址是 202.118.2.2，L 1 接口的 IP 地址是 130.11.120.1，E 0 接口的 IP 地址是 202.118.3.1；域名服务器的 IP 地址是 202.118.3.2。
![[Pasted image 20240703003436.png]]

![[Pasted image 20240703003443.png]]

⑴ 将 IP 地址空间 202.118.1.0/24 划分为 2 个子网，分别分配给局域网 1、局域网 2，每个局域网需分配的 IP 地址数不少于 120 个。请给出子网划分结果，说明理由或给出必要的计算过程。  

平均分配即可，因为每个都要不少于 120 个，显然只能静态分配。综上所述，划分的两个子网分别为 202.118.1.0/25，202.118.1.128/25。可以将子网 1 分配给局域网 1，子网 2 分配给局域网 2；也可以将子网 1 分配给局域网 2，子网 2 分配给局域网 1；本解答采用前者，具体如下：局域网 1: 网络地址为 202.118.1.0，子网掩码为 255.255.255.128 局域网 2: 网络地址为 202.118.1.128，子网掩码为 255.255.255.128
或者使用 CIDR 表示如下：
局域网 1: 网络地址为 202.118.1.0/25
局域网 2: 网络地址为 202.118.1.128/25

⑵ 请给出 R 1 的路由表，使其明确包括到局域网 1 的路由、局域网 2 的路由、域名服务器的主机路由和互联网的路由。
![[Pasted image 20240703003925.png]]
**如果我们确定了网络号，我们直接写网络号即可**。


⑶ 请采用路由聚合技术，给出 R 2 到局域网 1 和局域网 2 的路由。
![[Pasted image 20240703003953.png]]
![[Pasted image 20240703003948.png]]


![[Pasted image 20240703005650.png]]

答案：
(1) 主机 H1的 IP 地址为192.168.1.2/26，网络号占 26 位，主机号占 32-26 = 6位，将其后 8 位写成二进制形式，二进制位用红色表示， 192.168.1.00000010 。所属子网主机号的位用 x 表示，每个 x 可以取 0 或 1，得到 192.168.1.00xxxxxx 。

主机H2的IP地址为192.168.1.3/26，网络号占 26 位，主机号占 32-26 = 6位，将其后 8 位写成二进制形式，二进制位用红色表示， 192.168.1.01000010 。所属子网主机号的位用 x 表示，每个 x 可以取 0 或 1，得到 192.168.1.01xxxxxx 。

主机H3的IP地址为192.168.1.66/26，网络号占 26 位，主机号占 32-26 = 6位，将其后 8 位写成二进制形式，二进制位用红色表示， 192.168.1.01000011 。所属子网主机号的位用 x 表示，每个 x 可以取 0 或 1，得到 192.168.1.01xxxxxx 。

主机H4的IP地址为192.168.1.67/26，网络号占 26 位，主机号占 32-26 = 6位，将其后 8 位写成二进制形式，二进制位用红色表示， 192.168.1.01000011 。所属子网主机号的位用 x 表示，每个 x 可以取 0 或 1，得到 192.168.1.01xxxxxx 。

综上所述，主机H1的IP地址和主机H2的IP地址都属于子网空间 192.168.1.00xxxxxx ，即192.168.1.0/26。主机H3的IP地址和主机H4的IP地址都属于子网空间 192.168.1.01xxxxxx ，即192.168.1.64/26。

**H1 和 H2 属于同一个局域网**，通过**以太网**交换机（无VLAN功能）进行互联，设备2是以太网交换机。

**H3 和 H4 属于同一个局域网**，通过**以太网**交换机（无VLAN功能）进行互联，设备3是以太网交换机。

上述两个局域网通过路由器互联，设备1是路由器。

综上，设备 1 是路由器，设备2 是以太网交换机，设备3 是以太网交换机。

(2) 设备 1 为路由器，其接口应配置 IP 地址。
H1 和 H2 的默认网关均为 192.168.1.1，所以路由器的接口 IF2 的IP地址为192.168.1.1。
H3 和 H4 的默认网关均为 192.168.1.65，所以路由器的接口 IF3 的IP地址为192.168.1.65。
设备1的接口 IF1 与路由器 R 的 IP 地址为 192.168.1.253/30 的接口相连，IP地址为192.168.1.253/30，网络号占 30 位，主机号占 32-30 = 2位，将其后 8 位写成二进制形式，二进制位用红色表示， 192.168.1.11111101 。所属子网主机号的位用 x 表示，每个 x 可以取 0 或 1，得到 192.168.1.111111xx ，其地址空间地址数为 22=4 ，除去一个主机号位全0的网络地址和一个主机号位全1的广播地址，剩余2个地址 192.168.1.11111101 和 192.168.1.11111110 （即192.168.1.253和192.168.1.254）为两个可分配的主机号，192.168.1.253 已经被分配给路由器 R 的一个接口，因此设备1的接口 IF1 的 IP 地址为 192.168.1.254。
综上所述，设备1的IFl、IF2和IF3接口的IP地址分别是：192.168.1.254、192.168.1.1和192.168.1.65。

(3) 主机 H1、H2、H3 和设备1的所有接口以及 R 连接设备1的接口的 IP 地址都属于私有地址段的 C 类为 192.168.0.0~192.168.255.255，而 R 连接 Internet 的接口的 IP 地址 101.1.2.10 属于公有 IP 地址，所以 R 需要提供 NAT 服务，即网络地址转换服务。

(4) 主机 H3 发送一个目的地址为 192.168.1.127 的 IP 数据报。将 192.168.1.127 后 8 位写成二进制形式，二进制位用红色表示， 192.168.1.01111111 。该地址是主机 H3 所在子网 192.168.1.01xxxxxx 的广播地址，由于交换机不隔离广播域，交换机会向除进入交换机端口外的其他端口转发广播帧，设备3是交换机，该 IP 数据报通过设备3的端口 IF2 进入设备3，设备3会通过端口 IF1 和 IF3 转发该 IP 数据报，该 IP 数据报通过端口 IF1 到达设备1，设备1是路由器，路由器能够隔离广播域，因此会丢弃该数据报，该 IP 数据报通过端口 IF3 到达主机 H4，主机 H4 接受该数据报。

综上所述，只有主机 H4 会接收到数据报。
## 路由转发：
![[Pasted image 20240702170446.png]]


## OSPF 协议：
![[Pasted image 20240703004844.png]]
请根据题42描述的网络，继续回答下列问题。

(1) 假设路由表结构如下表所示，请给出题42图中R1的路由表，要求包括到达题42图中子网192.1.x.x的路由，且路由表中的路由项尽可能少。
![[Pasted image 20240703004906.png]]
(2) 当主机192.1.1.130向主机192.1.7.211发送一个TTL=64的IP分组时，R1通过哪个接口转发该IP分组？主机192.1.7.211收到的IP分组TTL是多少？

(3) 若 R1增加一条 Metric 为10的链路连接 Internet，则题42表中 R1的 LSI 需要增加哪些信息？

答案：
(1) 根据题 42 图，可以分析 R1到达各个子网的路由

目的网络 192.1.1.0/24，为 R1 的直连网络，通过接口 E0 进行转发。

目的网络 192.1.5.0/24，使用 OSPF 路由选择协议，选择费用最短的路径，即 R1→R3→192.1.5.0/24，下一跳为 R3 地址为 10.1.1.10 的接口，通过接口 L1 进行转发。

目的网络 192.1.6.0/24，使用 OSPF 路由选择协议，选择费用最短的路径，即 R1→R2→192.1.6.0/24，下一跳为 R2 地址为 10.1.1.2 的接口，通过接口 L0 进行转发。

目的网络 192.1.7.0/24，使用 OSPF 路由选择协议，选择费用最短的路径，即 R1→R2→192.1.7.0/24，下一跳为 R2 地址为 10.1.1.2 的接口，通过接口 L0 进行转发。

可写出 R1 的路由表如下：

|              |           |     |
| ------------ | --------- | --- |
| 目的网络         | 下一跳       | 接口  |
| 192.1.1.0/24 | -         | E0  |
| 192.1.5.0/24 | 10.1.1.10 | L1  |
| 192.1.6.0/24 | 10.1.1.2  | L0  |
| 192.1.7.0/24 | 10.1.1.2  | L0  |
(2) 第一问。主机 192.1.1.130 属于子网 192.1.1.0/24，主机192.1.7.211 属于子网 192.1.7.0/24，当主机192.1.1.130向主机192.1.7.211发送一个 TTL=64的 IP 分组时，使用 OSPF 路由选择协议，选择费用最短的路径，即192.1.1.130→R1→R2→R4→192.1.7.211，R1通过 L0转发该 IP 分组。

第二问。每经过一个路由器，TTL 值就会减 1，该传输路径中要经过 3 个路由器，所以主机192.1.7.211 收到该 IP 分组时，TTL = 64 - 3 = 61。

(3) R1 连接 Internet 需要增加一条默认路由，即 0.0.0.0/0。所以题 42 表中 R1 的 LSI 需要增加一项的网络前缀 Prefix 为 0.0.0.0/0，度量 Metric 为 10。

