### 总线定时和总线事物
## 总线操作
典型的总线操作包括请求操作、仲裁操作、地址传输、数据传输和总线释放。
1)请求：主设备（CPU 或 DMA）发出总线传输请求，并获得总线控制权。
2)仲裁（仲裁后，我们会能够获得我们的数据）
3)寻址（这一步，获得主使用权的模块通过总线发出本次要访问的从模块的地址以及有关命令，启动参与本次传输的从模块）
4)传输（主模块与我们的从模块进行数据交换，可以单向或者双向的进行我们的数据传送）
5)释放（主模块有关的信息均从系统总线上擦除，让出我们的总线控制权）

## 总线定时 ：
定义：规定了设备使用总线的时间，每一步该怎么做，不至于让我们的总线操作变得混乱。（**实质是一种协议**）目的就是解决主、从设备如何获知传输开始和传输结束，以及通知双方如何协调进行数据通信（[[TCP协议]]）。
同步方式：由统一的时钟进行我们的数据传送.。
异步方式：采用应答方式，没有公共的时钟标准。

方式：同步、异步、半同步、分离式
## 同步方式
有一个时钟信号线，总线上**所有设备都从这个时钟线上获得定时信号**，一定频率时钟信号定义了等间隔的时间段，称为一个时钟周期。假设我们的 CPU 作为我们的主设备，某个输入设备作为我们的从设备，
第一步：在第一个节拍，我们的 CPU 会发出我们的**地址信号**，说明我们的从设备地址
第二步：我们给出命令，我们要**读取**我们的从设备的对应数据。与地址信息相符的输入设备按照命令，进行一系列的内部操作。
第三步：我们把数据线的信息**传到内部寄存器**中
第四步：**撤销读命**令，不再传输数据。

而我们对于每个操作都规定了开始时间和结束时间。
![[Pasted image 20230807230129.png]]
![[Pasted image 20230807230309.png]]

![[Pasted image 20231227202051.png]]



## 异步方式
异步控制：没有一个公共的时钟信息，采用**握手协议**，由一系列步骤组成，只有双方都同意，才会进入到下一步。
而我们有根据我们的请求，回应是否撤销，分为我们的下面三种方式，不互锁方式，半互锁方式，全互锁方式。
### 不互锁方式
主设备发出“请求”信号后，不必等到接到从设备的“回答”信 号，而是**经过一段时间，便撤销**“请求”信号。
而从设备在接到“请求”信号后，发出“回答”信号，并经过一段时间，**自动撤销**“回答”信号。双方不存在互锁关系。

### 半互锁
主设备发出“请求”信号后，**必须待接到从设备的“回答”信号后，才撤销**“请求”信号，有互锁的关系。而从设备在接到“请求”信号后，发出“回答”信号，但不必等待获知主设备的“请求”信号已经撤销，而是**隔一段时间后自动撤销**“回答”信号，不存在互锁关系。

### 全互锁
主设备发出“请求”信号后，必须待**从设备“回答”后，才撤销**请求”信号；
从设备发出“回答”信号，必须待**获知主设备“请求”信号已撤销后，再撤销**其“回答”信号。双方存在互锁关系。

类比：按“电话联系”进行约会（**协议**）
![[Pasted image 20231227202656.png]]

## 半同步方式 ：
异步+时间戳, 与同步相比，增加了一个等待信号，**在我们跟不上节奏的时候，我们会让我们的总线控制器进行我们的等待**。
![[Pasted image 20231227202805.png]]

## 分离式通信
子周期一：主模块申请占用总线，使用后放弃总线的控制权。
子周期二：从模块申请占用总线，将各种信息送到总线上。

例题：
![[Pasted image 20230807231920.png]]
同步总线性能：
1. 时钟频率 50 ns
2. 工作频率=时钟频率 50 ns
3. 传输速率：20 MT/S
4. 带宽 20 M * 4 B

同步总线传送所需的步骤和时间为：
1. 发送地址和读命令到存储器 50 ns
2. 存储器读数据 200 ns
3. 传送数据到设备 50 ns
总时间为 300 ns，因为产生的数据传输率为 4 B/300 ns，

异步总线性能：
1. 共需要 7 次握手，包括两次应答过程，分别用来传送地址和数据

![[Pasted image 20230807232219.png]]
![[Pasted image 20230807232250.png]]
一共需要 360 ns