# 微指令设计
首先，因为我们的微程序中不存在我们的 PC（指令寄存器），所以，我们在设计微程序的过程中，也要**指明我们的下一个指令的地址**在哪里。

因此，我们就有：微指令=操作数+下一条地址所在的位置。因为我们的操作数是可以并行的，所以我们的一个微指令可以包含多个并行的微命令。
## 微指令的分类
1. 水平型微指令：**一条微指令**能够定义**多个**可并行的微命令。我们的**操作控制域内，直接控制我们哪些命令有效**。

2. 垂直型微指令：**一条微指令**只能定义**一个微命令**，由微操作码字段规定具体功能，此时我们解决了我们的并行处理问题，但是我们的微程序非常的长，会导致我们的速度很慢。（类似于我们的机器指令）

3. 混合型微指令：综上所述

### 水平型操作控制
我们水平型操作的控制的主要矛盾在于我们有些指令之间是矛盾的，我们要怎么样才能对应到我们的一个结果呢？

#### 直接编码方式
对于水平型操作控制字段，我们如果采用**直接编码方式**，那么我们的规则就是我们指令中的某**一位只对应我们的某一个指令**，如果对应位置为 1，有效，为 0，无效。
![[Pasted image 20231206152124.png]]
缺点：指令长度过长
优点：并行操作优秀

#### 字段直接编码方式
对于我们的字段直接编码方式，由于我们的某些操作是 `互斥` 的，也就是我们的真值表中存在着无关项，因此，我们可以通过我们的分组编码来优化我们的编码长度：


我们的操作控制字段被分为若干个 `m bit` 的小段，每个小段进行译码，译码输出表示微命令，我们最多有 $2^m$ 个微命令，但是，我们的要求是这 $2^m$ 个微命令，必须是 `彼此互斥的`，也就是说，这 $2^m$ 个微指令中，**只能有最多一个为 1
**。（留出一个状态表示不操作!!!）

因此我们的字段分段做出如下规定：
1. 互斥性内容在同一段内，相容性微命令在不同段内。
2. 每一个段内要留出一个状态，表示不发生任何操作。

![[Pasted image 20231206152600.png]]

例题：



![[Pasted image 20230813234329.png]]




![[Pasted image 20230814213154.png]]

### 垂直型操作控制
一条指令只执行一个命令。我们类似于我们的机器指令，我们的前面若干位表示我们执行的是什么指令，我们的后面的位置则表示我们的地址信息等等：
![[Pasted image 20231206152057.png]]

## 微指令地址格式
方法一：微指令的下地址字段指出（断定方式）
方法二：根据机器指令的操作码形成
方法三：有增量计数器获得（`PC`）
方法四：分支转移，操作字段的后半部分（实验）
方法五：测试网络
![[Pasted image 20230814215313.png]]

方法一：断定方式
先行微指令的下一条指令直接决定了下一条指令执行什么。现行微地址的下地址直接指定后续微地址的指令。
![[Pasted image 20231206155100.png]]

方法二：分支转移
我们的微程序考虑两种转移方式：
1. 机器指令微程序入口处转移，多路转移
2. 微程序中跳转微程序转移，2 路转移
我们的方法是在我们的微指令编码顺序控制字段中添加两个 `1bit` 字段来实现我们的转移。这个就是表明我们的**转移方式**，然后我们剩下的四位就表明我们的**目标地址**是哪里。
![[Pasted image 20231206160110.png]]


具体样例：
![[Pasted image 20231206160615.png]]

![[Pasted image 20231206160942.png]]

1. 两地址方式
首先，把我们的（汇编）指令代码交给我们的 `IR`,通过我们的 `IR`,我们会得到我们的微程序的首地址，我们把这个首地址放到我们的 `多路选择器`
![[Pasted image 20231206144216.png]]
之后我们把我们的数据付给我们的微地址寄存器 `μAR`，
![[Pasted image 20231206144312.png]]
再然后，我们把我们微地址寄存器中的内容通过我们的 `CM`,找到我们的对应微指令取出来，
![[Pasted image 20231206144402.png]]

因为我们是两地址格式，所以通常来说，我们的地址一会存放我们的顺序地址，地址 2 会存放我们的跳转地址。我们的 `AC` 负责进行我们的条件选择。
![[Pasted image 20231206144621.png]]
之后，如果我们满足 `AC` 的条件，我们给我们的多路选择器输入我们的跳转地址（吓一跳执行这个二），如果不满足 `AC` 的条件，我们就给我们的多路选择器输入我们的顺序地址（下一条执行这个）

改进：一地址指令：
添加我们的微 `PC`，省去我们微指令的长度，
![[Pasted image 20231206144827.png]]

再改进：
可变格式：将我们的微指令设计为两种格式，一类是我们的 0 地址指令，另一类是我们的跳转类的指令，
![[Pasted image 20231206145112.png]]
